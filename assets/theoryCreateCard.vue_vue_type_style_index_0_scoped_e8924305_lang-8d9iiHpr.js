import{D as h,E as l,u as p,c as u,f as d,o as g,a as c,t as w,x as y}from"./index-CHEkG5_n.js";import{_ as m}from"./_plugin-vue_export-helper-DlAUqK2U.js";const n={async getDisciplinesByStudent(e){const s=await fetch("http://localhost:8080/api/disciplines/my",{method:"GET",headers:{Accept:"application/json",Authorization:`Bearer ${e}`}});if(s.ok)return await s.json();{const r=await s.json();throw r.message||r.error||"Неизвестная ошибка"}},async getDisciplinesByTeacher(e){const s=await fetch("http://localhost:8080/api/disciplines",{method:"GET",headers:{Accept:"application/json",Authorization:`Bearer ${e}`}});if(s.ok)return await s.json();{const r=await s.json();throw r.message||r.error||"Неизвестная ошибка"}},async getGroupsForDiscipline(e,s){const r=await fetch(`http://localhost:8080/api/disciplines/${s}/groups`,{method:"GET",headers:{Accept:"*/*",Authorization:`Bearer ${e}`}});if(r.ok)return await r.json();{const t=await r.json();throw t.message||t.error||"Неизвестная ошибка"}},async addDiscipline(e,s,r){const t=await fetch("http://localhost:8080/api/disciplines",{method:"POST",headers:{Accept:"application/json",Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({name:s,description:r})});if(t.ok)return await t.json();{const o=await t.json();throw o.message||o.error||"Неизвестная ошибка"}},async addGroupForDiscipline(e,s,r){const t=await fetch(`http://localhost:8080/api/disciplines/${s}/groups/${r}`,{method:"POST",headers:{Accept:"application/json",Authorization:`Bearer ${e}`}});if(!t.ok){const o=await t.json();throw o.message||o.error||"Неизвестная ошибка"}},async updateDiscipline(e,s,r,t){const o=await fetch(`http://localhost:8080/api/disciplines/${s}`,{method:"PUT",headers:{Accept:"application/json",Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({name:r,description:t})});if(!o.ok){const a=await o.json();throw a.message||a.error||"Неизвестная ошибка"}},async deleteDiscipline(e,s){const r=await fetch(`http://localhost:8080/api/disciplines/${s}`,{method:"DELETE",headers:{Accept:"application/json",Authorization:`Bearer ${e}`}});if(!r.ok){const t=await r.json();throw t.message||t.error||"Неизвестная ошибка"}},async deleteGroupForDiscipline(e,s,r){const t=await fetch(`http://localhost:8080/api/disciplines/${s}/groups/${r}`,{method:"DELETE",headers:{Accept:"application/json",Authorization:`Bearer ${e}`}});if(!t.ok){const o=await t.json();throw o.message||o.error||"Неизвестная ошибка"}}},i={async getGroupsByUser(e){return new Promise(s=>{setTimeout(()=>{const r=h.groups;s(r)},500)})},async getAllGroups(e){const s=await fetch("http://localhost:8080/api/groups",{method:"GET",headers:{Accept:"application/json",Authorization:`Bearer ${e}`}});if(s.ok)return await s.json();{const r=await s.json();throw r.message||r.error||"Неизвестная ошибка"}},async getMyGroup(e){const s=await fetch("http://localhost:8080/api/groups/group",{method:"GET",headers:{Accept:"application/json",Authorization:`Bearer ${e}`}});if(s.ok)return await s.json();{const r=await s.json();throw r.message||r.error||"Неизвестная ошибка"}},async getUsersByGroup(e,s){const r=await fetch(`http://localhost:8080/api/groups/${s}/students`,{method:"GET",headers:{Accept:"application/json",Authorization:`Bearer ${e}`}});if(r.ok)return await r.json();{const t=await r.json();throw t.message||t.error||"Неизвестная ошибка"}},async getUsers(e){const s=await fetch("http://localhost:8080/api/groups/group",{method:"GET",headers:{Accept:"application/json",Authorization:`Bearer ${e}`}});if(s.ok)return await s.json();{const r=await s.json();throw r.message||r.error||"Неизвестная ошибка"}},async getUsersWithoutGroup(e){const s=await fetch("http://localhost:8080/api/groups/users/unassigned",{method:"GET",headers:{Accept:"application/json",Authorization:`Bearer ${e}`}});if(s.ok)return await s.json();{const r=await s.json();throw r.message||r.error||"Неизвестная ошибка"}},async createGroup(e,s){const r=await fetch("http://localhost:8080/api/groups",{method:"POST",headers:{Accept:"application/json",Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({name:s})});if(r.ok)return await r.json();{const t=await r.json();throw t.message||t.error||"Неизвестная ошибка"}},async updateGroup(e,s,r){const t=await fetch(`http://localhost:8080/api/groups/${s}`,{method:"PUT",headers:{Accept:"application/json",Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({name:r})});if(t.ok)return await t.json();{const o=await t.json();throw o.message||o.error||"Неизвестная ошибка"}},async deleteGroup(e,s){const r=await fetch(`http://localhost:8080/api/groups/${s}`,{method:"DELETE",headers:{Accept:"*/*",Authorization:`Bearer ${e}`}});if(!r.ok){const t=await r.json();throw t.message||t.error||"Неизвестная ошибка"}},async addUserForGroup(e,s,r){const t=await fetch(`http://localhost:8080/api/groups/${s}/users/${r}`,{method:"PUT",headers:{Accept:"*/*",Authorization:`Bearer ${e}`}});if(!t.ok){const o=await t.json();throw o.message||o.error||"Неизвестная ошибка"}},async deleteUserFromGroup(e,s,r){const t=await fetch(`http://localhost:8080/api/groups/${s}/users/${r}`,{method:"DELETE",headers:{Accept:"*/*",Authorization:`Bearer ${e}`}});if(!t.ok){const o=await t.json();throw o.message||o.error||"Неизвестная ошибка"}},async getGroupsForDiscipline(e,s){const r=await fetch(`http://localhost:8080/api/disciplines/${s}/groups`,{method:"GET",headers:{Accept:"*/*",Authorization:`Bearer ${e}`}});if(r.ok)return await r.json();{const t=await r.json();throw t.message||t.error||"Неизвестная ошибка"}}},G=l("group",{state:()=>({allGroups:[],allUsers:[],myGroup:null,selectedGroupId:"without"}),getters:{userToken:()=>p().token,selectedDisciplineId:()=>D().selectedDisciplineId,getGroupById(){return e=>this.allGroups.find(s=>s.id===e)},getSelectedGroupName(){var e;return this.selectedGroupId==="without"?"без группы":((e=this.allGroups.find(s=>s.id===this.selectedGroupId))==null?void 0:e.name)??"Группы"},getMyGroupName(){var e;return((e=this.myGroup)==null?void 0:e.name)??"Нет группы"}},actions:{async setStudentUsers(){try{const e=await i.getMyGroup(this.userToken);e&&(this.myGroup={id:e.id,name:e.name},this.allUsers=e.users)}catch{this.myGroup=null,this.allUsers=[]}},async setTeacherUsers(){try{let e=null;this.selectedGroupId==="without"?e=await i.getUsersWithoutGroup(this.userToken):e=await i.getUsersByGroup(this.userToken,this.selectedGroupId),this.allUsers=e}catch{this.allUsers=[]}},async getUsersWithoutGroup(){try{return await i.getUsersWithoutGroup(this.userToken)}catch(e){this.allUsers=[],alert(`Ошибка: ${e}`)}},async setGroups(){try{const e=await this.getGroups();this.allGroups=e}catch{this.allGroups=[]}},async getGroups(){try{return await i.getAllGroups(this.userToken)}catch(e){alert(`Ошибка: ${e}`)}},async createGroup(e){try{await i.createGroup(this.userToken,e),await this.setGroups()}catch(s){alert(`Ошибка: ${s}`)}},async updateGroup(e){try{await i.updateGroup(this.userToken,this.selectedGroupId,e),await this.setGroups()}catch(s){alert(`Ошибка: ${s}`)}},async deleteGroup(){try{if(this.allUsers.length)for(let e=0;e<this.allUsers.length;e++)await i.deleteUserFromGroup(this.userToken,this.selectedGroupId,this.allUsers[e].id);await i.deleteGroup(this.userToken,this.selectedGroupId),this.selectedGroupId="without",await this.setGroups(),await this.setTeacherUsers()}catch(e){alert(`Ошибка: ${e}`)}},async addUsersForGroup(e){try{for(let s=0;s<e.length;s++)await i.addUserForGroup(this.userToken,this.selectedGroupId,e[s].id);return await this.setTeacherUsers(),{success:!0}}catch(s){return alert(`Ошибка: ${s}`),{success:!1,message:s.message}}},async deleteUserFromGroup(e){try{return console.log(e),await i.deleteUserFromGroup(this.userToken,this.selectedGroupId,e),await this.setTeacherUsers(),{success:!0}}catch(s){return alert(`Ошибка: ${s}`),{success:!1,message:s.message}}},async changeUserGroup(e,s){try{return e!=this.selectedGroupId&&(await i.addUserForGroup(this.userToken,e,s),await this.setTeacherUsers()),{success:!0}}catch(r){return alert(`Ошибка: ${r}`),{success:!1,message:r.message}}},async getGroupsForDiscipline(e){try{return e?await i.getGroupsForDiscipline(this.userToken,e):[]}catch(s){alert(`Ошибка: ${s}`)}}},persist:!0}),D=l("disciplines",{state:()=>({allDisciplines:[],selectedDisciplineId:null,groupsForDiscipline:[]}),getters:{userToken:()=>p().token??null,async allGroups(){return await G().getGroups()},getDisciplineById(){return e=>{var s;return(s=this.allDisciplines)==null?void 0:s.find(r=>r.id==e)}},getSelectedDisciplineName(){var e;return((e=this.allDisciplines.find(s=>s.id===this.selectedDisciplineId))==null?void 0:e.name)??"Дисциплины"}},actions:{async setDisciplinesByTeacher(){try{const e=await n.getDisciplinesByTeacher(this.userToken);this.allDisciplines=e}catch(e){this.allDisciplines=[],alert(`Ошибка: ${e}`)}},async setDisciplinesByStudent(){try{const e=await n.getDisciplinesByStudent(this.userToken);this.allDisciplines=e}catch(e){this.allDisciplines=[],alert(`Ошибка: ${e}`)}},async setGroupsForDiscipline(){try{if(this.selectedDisciplineId){const e=await n.getGroupsForDiscipline(this.userToken,this.selectedDisciplineId);return e?this.groupsForDiscipline=e:this.groupsForDiscipline=[],e}}catch(e){return alert(`Ошибка: ${e}`),{success:!1,message:e}}},async createDiscipline(e,s,r){try{const t=await n.addDiscipline(this.userToken,e,s);if(t)for(let o=0;o<r.length;o++)await n.addGroupForDiscipline(this.userToken,t.id,r[o].id);return await this.setDisciplinesByTeacher(),{success:!0}}catch(t){return alert(`Ошибка: ${t}`),{success:!1,message:t}}},async updateDisciplineName(e,s){try{return await n.updateDiscipline(this.userToken,this.selectedDisciplineId,e,s),await this.setDisciplinesByTeacher(),{success:!0}}catch(r){return alert(`Ошибка: ${r}`),{success:!1,message:r}}},async updateGroups(e){try{const s=await n.getGroupsForDiscipline(this.userToken,this.selectedDisciplineId),r=e.filter(o=>!s.some(a=>a.id===o.id)),t=s.filter(o=>!e.some(a=>a.id===o.id));for(let o=0;o<t.length;o++)await n.deleteGroupForDiscipline(this.userToken,this.selectedDisciplineId,t[o].id);for(let o=0;o<r.length;o++)await n.addGroupForDiscipline(this.userToken,this.selectedDisciplineId,r[o].id);return await this.setGroupsForDiscipline(),{success:!0}}catch(s){return alert(`Ошибка: ${s}`),{success:!1,message:s}}},async deleteDiscipline(){try{return await n.deleteDiscipline(this.userToken,this.selectedDisciplineId),await this.setDisciplinesByTeacher(),this.selectedDisciplineId=null,{success:!0}}catch(e){return alert(`Ошибка: ${e}`),{success:!1,message:e}}}},persist:!0}),f="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAABBUlEQVR4nO3ZTQqDMBAF4HeKPOkV2+MWbE9jKXUhRcQk8xeZt3Il8xFNZgiQyWQyV8odwORdBH41fGtpygPAAmB2xkxrDctaU3UKgOf6gjeAG+zDTQ2vnho8MZRCeGIojfDAUAthiaE2wgJjhtDEmCM0MG4ISYw7QgITBtGDCYdowYRF1GDCI85ghkEcYYZD7M0Q899zhEGteWWGW4lttp+T53DWlUt8Wtz5sSOMzVU52p2GwfDEFhsew4pzIiyGDYddOAw7TuwwGAq0He4YCvZObhgqNIDmGCp2sWYYi1a8aGMs54mihfEYioo0xnOyK1KYCONpkcBc5urtMpehmUwmg3D5AAklyc9YEtl/AAAAAElFTkSuQmCC",A={key:0,class:"modal-overlay"},T={class:"modal-content"},k={class:"title"},j={class:"blood_label"},$={class:"modal_card"},M={__name:"modal",props:{isOpen:{type:Boolean,default:!1},title:{type:String,default:"Модалка"}},emits:["close"],setup(e,{emit:s}){const r=s;return(t,o)=>e.isOpen?(g(),u("div",A,[c("div",T,[c("div",k,[c("div",j,w(e.title),1),c("img",{src:f,alt:"закрыть",onClick:o[0]||(o[0]=a=>r("close"))})]),c("div",$,[y(t.$slots,"default",{},void 0,!0)])])])):d("",!0)}},I=m(M,[["__scopeId","data-v-4d6c9006"]]);export{G as a,I as m,D as u};
